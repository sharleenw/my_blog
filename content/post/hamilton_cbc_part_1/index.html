---
title: 'Hamilton Christmas Bird Count: Part 1'
subtitle: 'Importing and cleaning the Hamilton Christmas Bird Count data'
author: Sharleen
date: '2019-01-07'
slug: hamilton-christmas-bird-count-part-1
summary: Importing and cleaning the Hamilton Christmas Bird Count data.
categories: []
tags:
  - data analysis
  - R
  - natural history
  - ornithology
  - ecology
  - birding
  - regex
  - tidyverse
draft: false
image:
  caption: 'Black-Capped Chickadee image credit: [**Public Domain Pictures**](https://www.publicdomainpictures.net/en/view-image.php?image=243075&picture=black-capped-chickadee-on-branch-3)'
  preview_only: false
---

<script src="/rmarkdown-libs/kePrint/kePrint.js"></script>


<div id="note" class="section level1">
<h1>Note</h1>
<p>This is the first part of five for this dataset.</p>
<ul>
<li><p><a href="https://sharleenw.rbind.io/post/hamilton_cbc_part_2a/hamilton-christmas-bird-count-part-2a/">Part 2a</a> contains data downloading and cleaning</p></li>
<li><p><a href="https://sharleenw.rbind.io/post/hamilton_cbc_part_2b/hamilton-christmas-bird-count-part-2b/">Part 2b</a> contains visualizations</p></li>
<li><p><a href="https://sharleenw.rbind.io/post/hamilton_cbc_part_3/hamilton-christmas-bird-count-part-3/">Part 3</a> contains my Shiny app!</p></li>
<li><p><a href="https://sharleenw.rbind.io/post/hamilton_cbc_part_4/hamilton-christmas-bird-count-part-4/">Part 4</a> contains a gganimated plot</p></li>
</ul>
</div>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>About two years ago, I was taking my dog for a walk through a park and I began to notice the birds and how fascinating they were! :bird: I began regularly going out birding (aka “bird-watching”) and reading up on these cool little flying dinosaurs.</p>
<p>It turns out there’s a lot of data in the birding world as well. Birding attracts the sort of detail-oriented person who likes to count and record stuff.</p>
<p>So there are opportunities to get involved in citizen science projects, including a long-running project called the Christmas Bird Count (CBC). It started in 1900, when Frank Chapman, an ornithologist, came up with the idea of counting birds as an alternative to hunting them at Christmas (hunting them being the previous tradition).<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a></p>
<p>Birders have been going out every year around Christmas, to spend the day walking, biking, or driving through a census area to count all the birds they see or hear.</p>
<p>For the past two years, I have gone out with Hamilton’s Christmas Bird Count. I learn a lot while I’m out there and it feels like we are contributing to a larger purpose because of the data we are collecting.</p>
<p>So I thought I would look at the data and see what it could tell me!</p>
<p>Specifically, I’ve noticed birders will say things like, “the House Sparrows are getting worse every year” or, “the number of Bald Eagles has increased”, and I was wondering if the Christmas Bird Count data would agree or disagree with those statements.</p>
<p>To access the data, I went on the <a href="https://www.birdscanada.org/index.jsp">Bird Studies Canada</a> website, clicked on Citizen Science, then Christmas Bird Count, then CBC Audubon Database, and then Historical Results by Count. I downloaded all years of data that existed for the Hamilton count.</p>
</div>
<div id="data-import" class="section level1">
<h1>Data import</h1>
<p>I started by loading all of the packages I will be using:</p>
<pre class="r"><code>library(dplyr)
library(janitor)
library(readr)
library(naniar)
library(lubridate)
library(stringr)
library(purrr)
library(tidyr)
library(knitr)
library(kableExtra)
library(here)</code></pre>
<p>I read in the data using the <a href="https://readr.tidyverse.org/"><code>readr</code></a> and <a href="https://malco.io/2018/11/05/why-should-i-use-the-here-package/"><code>here</code></a> packages.</p>
<pre class="r"><code>hamilton_cbc &lt;- read_csv(here(&quot;content&quot;, &quot;post&quot;, &quot;hamilton_cbc_part_1&quot;, &quot;hamilton-cbc-all-years-csv.csv&quot;))</code></pre>
</div>
<div id="data-cleaning" class="section level1">
<h1>Data cleaning</h1>
<p>As shown below, it turns out that the first row just gives information about the count name and latitude/longitude, so I extracted those two pieces of information as <code>current_circle_name</code> and <code>lat_long</code> and then <a href="https://dplyr.tidyverse.org/reference/slice.html"><code>slice</code>d</a> the file so that the first two lines were excluded from the dataset. I then used <code>clean_names</code> from the <a href="https://www.rdocumentation.org/packages/janitor/versions/1.1.1/topics/clean_names"><code>janitor</code></a> package.</p>
<pre class="r"><code>hamilton_cbc %&gt;%
  head() %&gt;%
  kable() %&gt;%
  kable_styling(full_width = FALSE, position = &quot;left&quot;)</code></pre>
<table class="table" style="width: auto !important; ">
<thead>
<tr>
<th style="text-align:left;">
CircleName
</th>
<th style="text-align:left;">
Abbrev
</th>
<th style="text-align:left;">
LatLong
</th>
<th style="text-align:left;">
X4
</th>
<th style="text-align:left;">
X5
</th>
<th style="text-align:left;">
X6
</th>
<th style="text-align:left;">
X7
</th>
<th style="text-align:left;">
X8
</th>
<th style="text-align:left;">
X9
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Hamilton
</td>
<td style="text-align:left;">
ONHA
</td>
<td style="text-align:left;">
43.2678790000/-79.8852320000
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
CountYear3
</td>
<td style="text-align:left;">
LowTemp
</td>
<td style="text-align:left;">
HighTemp
</td>
<td style="text-align:left;">
AMCloud
</td>
<td style="text-align:left;">
PMClouds
</td>
<td style="text-align:left;">
AMRain
</td>
<td style="text-align:left;">
PMRain
</td>
<td style="text-align:left;">
AMSnow
</td>
<td style="text-align:left;">
PMSnow
</td>
</tr>
<tr>
<td style="text-align:left;">
118
</td>
<td style="text-align:left;">
-18.0 Celsius
</td>
<td style="text-align:left;">
-13.0 Celsius
</td>
<td style="text-align:left;">
Clear
</td>
<td style="text-align:left;">
Clear
</td>
<td style="text-align:left;">
None
</td>
<td style="text-align:left;">
None
</td>
<td style="text-align:left;">
None
</td>
<td style="text-align:left;">
None
</td>
</tr>
<tr>
<td style="text-align:left;">
117
</td>
<td style="text-align:left;">
-2.0 Celsius
</td>
<td style="text-align:left;">
11.0 Celsius
</td>
<td style="text-align:left;">
Cloudy
</td>
<td style="text-align:left;">
Cloudy
</td>
<td style="text-align:left;">
Light
</td>
<td style="text-align:left;">
Heavy Light
</td>
<td style="text-align:left;">
None
</td>
<td style="text-align:left;">
None
</td>
</tr>
<tr>
<td style="text-align:left;">
116
</td>
<td style="text-align:left;">
-2.0 Celsius
</td>
<td style="text-align:left;">
5.0 Celsius
</td>
<td style="text-align:left;">
Partly Cloudy
</td>
<td style="text-align:left;">
Partly Cloudy
</td>
<td style="text-align:left;">
None
</td>
<td style="text-align:left;">
Light
</td>
<td style="text-align:left;">
None
</td>
<td style="text-align:left;">
None
</td>
</tr>
</tbody>
</table>
<pre class="r"><code>current_circle_name &lt;- hamilton_cbc[1, 1]
lat_long &lt;- hamilton_cbc[1, 3]

hamilton_cbc &lt;- hamilton_cbc %&gt;%
  slice(3 : n())

hamilton_cbc &lt;- hamilton_cbc %&gt;%
  clean_names()</code></pre>
<p>Since I played around with the data before writing this, I know that there are actually five tables in this dataset.</p>
<p>The first three tables contain count day weather data. A lot of the weather data is missing and possibly inconsistent. I will remove these three tables from <code>hamilton_cbc</code>.</p>
<p>Here is the end of the first table and the start of the second table. Notice the line of <code>NA</code>s between the two tables:</p>
<pre class="r"><code>hamilton_cbc %&gt;%
  slice(47:54) %&gt;%
  kable() %&gt;%
  kable_styling(full_width = FALSE, position = &quot;left&quot;)</code></pre>
<table class="table" style="width: auto !important; ">
<thead>
<tr>
<th style="text-align:left;">
circle_name
</th>
<th style="text-align:left;">
abbrev
</th>
<th style="text-align:left;">
lat_long
</th>
<th style="text-align:left;">
x4
</th>
<th style="text-align:left;">
x5
</th>
<th style="text-align:left;">
x6
</th>
<th style="text-align:left;">
x7
</th>
<th style="text-align:left;">
x8
</th>
<th style="text-align:left;">
x9
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
66
</td>
<td style="text-align:left;">
10
</td>
<td style="text-align:left;">
25
</td>
<td style="text-align:left;">
Clear
</td>
<td style="text-align:left;">
Clear
</td>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
Unknown
</td>
</tr>
<tr>
<td style="text-align:left;">
65
</td>
<td style="text-align:left;">
18
</td>
<td style="text-align:left;">
31
</td>
<td style="text-align:left;">
Cloudy
</td>
<td style="text-align:left;">
Cloudy
</td>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
Unknown
</td>
</tr>
<tr>
<td style="text-align:left;">
64
</td>
<td style="text-align:left;">
26
</td>
<td style="text-align:left;">
34
</td>
<td style="text-align:left;">
Cloudy
</td>
<td style="text-align:left;">
Cloudy
</td>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
Unknown
</td>
</tr>
<tr>
<td style="text-align:left;">
63
</td>
<td style="text-align:left;">
21
</td>
<td style="text-align:left;">
36
</td>
<td style="text-align:left;">
Cloudy
</td>
<td style="text-align:left;">
Cloudy
</td>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:left;">
Unknown
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
CountYear5
</td>
<td style="text-align:left;">
LowTemp3
</td>
<td style="text-align:left;">
HighTemp2
</td>
<td style="text-align:left;">
AMCloud2
</td>
<td style="text-align:left;">
PMClouds2
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
118
</td>
<td style="text-align:left;">
12/26/2017
</td>
<td style="text-align:left;">
85
</td>
<td style="text-align:left;">
198.75
</td>
<td style="text-align:left;">
100
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
117
</td>
<td style="text-align:left;">
12/26/2016
</td>
<td style="text-align:left;">
95
</td>
<td style="text-align:left;">
216.65
</td>
<td style="text-align:left;">
97
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
</tbody>
</table>
<p>Here is the end of the second table and the start of the third table. Notice the line of <code>NA</code>s between the two tables:</p>
<pre class="r"><code>hamilton_cbc %&gt;% 
  slice(143:150) %&gt;%
  kable() %&gt;%
  kable_styling(full_width = FALSE, position = &quot;left&quot;)</code></pre>
<table class="table" style="width: auto !important; ">
<thead>
<tr>
<th style="text-align:left;">
circle_name
</th>
<th style="text-align:left;">
abbrev
</th>
<th style="text-align:left;">
lat_long
</th>
<th style="text-align:left;">
x4
</th>
<th style="text-align:left;">
x5
</th>
<th style="text-align:left;">
x6
</th>
<th style="text-align:left;">
x7
</th>
<th style="text-align:left;">
x8
</th>
<th style="text-align:left;">
x9
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
26
</td>
<td style="text-align:left;">
12/26/1925
</td>
<td style="text-align:left;">
10
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
25
</td>
<td style="text-align:left;">
12/27/1924
</td>
<td style="text-align:left;">
8
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
23
</td>
<td style="text-align:left;">
12/26/1922
</td>
<td style="text-align:left;">
9
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
22
</td>
<td style="text-align:left;">
12/23/1921
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
8
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
CountYear4
</td>
<td style="text-align:left;">
LowTemp2
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
118
</td>
<td style="text-align:left;">
Hamilton Naturalists’ Club
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
117
</td>
<td style="text-align:left;">
Hamilton Naturalists’ Club
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
</tbody>
</table>
<p>Here is the end of the third table and the start of the fourth table. Notice that there is a line of <code>NA</code>s between the two tables. The fourth table is where the bird count data actually starts!</p>
<pre class="r"><code>hamilton_cbc %&gt;%
  slice(239:246) %&gt;%
  kable() %&gt;%
  kable_styling(full_width = FALSE, position = &quot;left&quot;)</code></pre>
<table class="table" style="width: auto !important; ">
<thead>
<tr>
<th style="text-align:left;">
circle_name
</th>
<th style="text-align:left;">
abbrev
</th>
<th style="text-align:left;">
lat_long
</th>
<th style="text-align:left;">
x4
</th>
<th style="text-align:left;">
x5
</th>
<th style="text-align:left;">
x6
</th>
<th style="text-align:left;">
x7
</th>
<th style="text-align:left;">
x8
</th>
<th style="text-align:left;">
x9
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
26
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
25
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
23
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
22
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
COM_NAME
</td>
<td style="text-align:left;">
CountYear
</td>
<td style="text-align:left;">
how_manyCW
</td>
<td style="text-align:left;">
NumberByPartyHours
</td>
<td style="text-align:left;">
Flags
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Snow Goose [Chen caerulescens]
</td>
<td style="text-align:left;">
1921 [22] Count Date: 12/23/1921 # Participants: # Species Reported: Total Hrs.: 8.00
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Snow Goose [Chen caerulescens]
</td>
<td style="text-align:left;">
1922 [23] Count Date: 12/26/1922 # Participants: # Species Reported: Total Hrs.:
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
</tbody>
</table>
<p>I decided to programmatically separate the first three tables out from the dataset, in order to be able to easily replicate this analysis when more years’ data gets added, or if I want to repeat this analysis for another count area.</p>
<pre class="r"><code># Declare two lists, one for each table and one for the header of each table
meta_data_table &lt;- list()
meta_data_table_headers &lt;- list()


for (i in 1:3) {
  
  # For each of the three tables, put the first row of data into this variable (i.e., the header data)
  meta_data_table_headers[[i]] &lt;- hamilton_cbc[1, ] %&gt;%
    replace(is.na(.), &quot;NA&quot;)  # If a column name is NA, replace that with the letters &quot;NA&quot;, in case there is data in the column
  
  
  j &lt;- 2  # Start j at 2, because we want to exclude the header row
  meta_data_row &lt;- list()
  
  # Add each row of data to meta_data_row
  while (!is.na(hamilton_cbc[[&quot;circle_name&quot;]][j])) {  # &quot;circle_name&quot; being the name of the first column and we know there is a row of NAs between each table
    meta_data_row[[j]] &lt;- hamilton_cbc[j, ]
    j &lt;- j + 1
  }
  
  meta_data_table[[i]] &lt;- meta_data_row %&gt;%
    bind_rows()

  
  meta_data_table[[i]] &lt;- meta_data_table[[i]] %&gt;%
    rename_all(funs(meta_data_table_headers[[i]])) %&gt;%
    remove_empty(which = &quot;cols&quot;) %&gt;% 
    rename(count_year = 1) %&gt;%  # rename knows we are referring to the first column!
    clean_names()

  
  # Remove the meta-data table from the rest of the dataset
  hamilton_cbc &lt;- hamilton_cbc %&gt;%
    slice((j + 1) : n())
}</code></pre>
<pre><code>## Warning: funs() is soft deprecated as of dplyr 0.8.0
## please use list() instead
## 
## # Before:
## funs(name = f(.)
## 
## # After: 
## list(name = ~f(.))
## This warning is displayed once per session.</code></pre>
<p>Whew! So now we have a list <code>meta_data_table</code> that contains the three meta-data tables.</p>
<p>In the below code chunk, I converted the three tables in the <code>meta_data_table</code> list into one <code>overall_meta_data</code> table using the <code>reduce</code> function from the <a href="https://purrr.tidyverse.org/"><code>purrr</code></a> package.</p>
<p>Then, using the <code>replace_with_na_all</code> function from the <a href="https://cran.r-project.org/web/packages/naniar/vignettes/replace-with-na.html"><code>naniar</code></a> package, anywhere the data was recorded as “Unknown”, I converted it to a proper <code>NA</code>.</p>
<p>I then <code>mutate</code>d two of the variables: I used the <code>mdy</code> and <code>year</code> functions from the <a href="https://cran.r-project.org/web/packages/lubridate/vignettes/lubridate.html"><code>lubridate</code></a> to convert the character variables <code>low_temp3</code> (actually a date variable) and <code>date</code> into a <code>Date</code> and <code>dbl</code> variable, respectively.</p>
<p>I also used the <code>word</code> function from the <a href="https://cran.r-project.org/web/packages/stringr/vignettes/stringr.html"><code>stringr</code></a> package. The <code>word</code> function extracts out only the first word from a character string.</p>
<pre class="r"><code># Reduce documentation: reduce(list(x1, x2, x3), f) is equivalent to f(f(x1, x2), x3)

overall_meta_data &lt;- meta_data_table %&gt;%
  reduce(full_join, by = &quot;count_year&quot;)

overall_meta_data &lt;- overall_meta_data %&gt;%
  replace_with_na_all(condition = ~.x == &quot;Unknown&quot;)

overall_meta_data &lt;- overall_meta_data %&gt;%
  mutate(date = mdy(low_temp3),
         low_temp = word(low_temp), # Extracts the first word from a string!
         high_temp = word(high_temp),
         year = year(date)) %&gt;%
  select(year, date, count_year, low_temp:pm_snow)
# I removed some confusing variables high_temp2:pm_clouds2</code></pre>
<p>We can finally clean up the bird count dataset a bit.</p>
<p>I used the <code>rename_all</code> function along with <code>slice(-1)</code> to remove the column names from the first row and make them the real column names.</p>
<pre class="r"><code>hamilton_cbc &lt;- hamilton_cbc %&gt;%
  remove_empty(which = &quot;cols&quot;)

hamilton_cbc &lt;- hamilton_cbc %&gt;%  # Do this line after removing the empty columns!
  rename_all(funs(hamilton_cbc[1, ])) %&gt;%
  slice(-1) %&gt;%
  clean_names()

hamilton_cbc &lt;- hamilton_cbc %&gt;%
  rename(species = com_name)</code></pre>
<p>But we still need to deal with the fact that there is a fifth table below the bird count data table. Here is the end of the fourth table and the start of the fifth table. Notice that there is a line of <code>NA</code>s between the two tables:</p>
<pre class="r"><code>hamilton_cbc %&gt;%
  slice(23217:(hamilton_cbc %&gt;%
          mutate(row_number = row_number()) %&gt;%
          filter(species == &quot;CountYear1&quot;) %&gt;%
            pull(row_number))) %&gt;%
  kable() %&gt;%
  kable_styling(full_width = FALSE, position = &quot;left&quot;)</code></pre>
<table class="table" style="width: auto !important; ">
<thead>
<tr>
<th style="text-align:left;">
species
</th>
<th style="text-align:left;">
count_year
</th>
<th style="text-align:left;">
how_many_cw
</th>
<th style="text-align:left;">
number_by_party_hours
</th>
<th style="text-align:left;">
flags
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
House Sparrow [Passer domesticus]
</td>
<td style="text-align:left;">
2016 [117] Count Date: 12/26/2016 # Participants: 1 # Species Reported: 97 Total Hrs.: 216.65
</td>
<td style="text-align:left;">
2565
</td>
<td style="text-align:left;">
11.8394
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
House Sparrow [Passer domesticus]
</td>
<td style="text-align:left;">
2017 [118] Count Date: 12/26/2017 # Participants: 1 # Species Reported: 100 Total Hrs.: 198.75
</td>
<td style="text-align:left;">
2731
</td>
<td style="text-align:left;">
13.7409
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
CountYear1
</td>
<td style="text-align:left;">
FirstName
</td>
<td style="text-align:left;">
LastName
</td>
<td style="text-align:left;">
Email
</td>
<td style="text-align:left;">
IsPrimary
</td>
</tr>
</tbody>
</table>
<p>I won’t show the data of the fifth table here, but it shows the full names of the counters. I don’t want to add this data to <code>overall_meta_table</code>, so I will just remove the table from the dataset.</p>
<p>In order to remove the fifth table, I noticed that every row of the bird count data included a <code>[</code> character in the species variable (for example: “Snow Goose [Chen caerulescens]”), so I filtered out every row in the dataset that didn’t have the <code>[</code> character. Notice that, in the <code>str_detect</code> filter, I put two <code>\</code>’s in front of the <code>[</code>. That is because the <code>[</code> is a special regex character and <code>str_detect</code> needs to know I mean the actual character <code>[</code>, and putting two <code>\</code>’s in front of the <code>[</code> is how to do that.</p>
<pre class="r"><code>hamilton_cbc &lt;- hamilton_cbc %&gt;%
  filter(str_detect(species, &quot;\\[&quot;))</code></pre>
<p>So, where are we at the moment? We have only one dataset left, and it looks like this:</p>
<pre class="r"><code>hamilton_cbc %&gt;%
  head(n = 3) %&gt;%
  kable() %&gt;%
  kable_styling(full_width = FALSE, position = &quot;left&quot;)</code></pre>
<table class="table" style="width: auto !important; ">
<thead>
<tr>
<th style="text-align:left;">
species
</th>
<th style="text-align:left;">
count_year
</th>
<th style="text-align:left;">
how_many_cw
</th>
<th style="text-align:left;">
number_by_party_hours
</th>
<th style="text-align:left;">
flags
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Snow Goose [Chen caerulescens]
</td>
<td style="text-align:left;">
1921 [22] Count Date: 12/23/1921 # Participants: # Species Reported: Total Hrs.: 8.00
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Snow Goose [Chen caerulescens]
</td>
<td style="text-align:left;">
1922 [23] Count Date: 12/26/1922 # Participants: # Species Reported: Total Hrs.:
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Snow Goose [Chen caerulescens]
</td>
<td style="text-align:left;">
1924 [25] Count Date: 12/27/1924 # Participants: # Species Reported: Total Hrs.:
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
</tbody>
</table>
<ul>
<li><code>species</code> gives the species name in English and the scientific name</li>
<li><code>count_year</code> data has a lot of information that we will parse out in a moment</li>
<li><code>how_many_cw</code> provides the actual bird count</li>
<li><code>number_by_party_hours</code> is how many birds were counted divided by the number of person-hours that year</li>
<li><code>flags</code> contains values like <code>US</code> for “unusual” bird (as per the Christmas Bird Count <a href="https://www.audubon.org/sites/default/files/documents/compilers_manual_0.pdf">documentation</a>)</li>
</ul>
<p>Now, we do some regex!</p>
<p>First, I want to split up the <code>species</code> variable into the common <code>species</code> name and the scientific <code>species_latin</code> name.</p>
<p>For the first mutate: I will use <code>@kohske</code>’s regex I found on <a href="https://stackoverflow.com/questions/8613237/extract-info-inside-all-parenthesis-in-r">StackOverflow</a>, which, as Nettle writes:</p>
<blockquote>
<p>I like <span class="citation">@kohske</span>’s regex, which looks behind for an open parenthesis ?&lt;=\(, looks ahead for a closing parenthesis ?=\), and grabs everything in the middle (lazily) .+?, in other words (?&lt;=\().+?(?=\))</p>
</blockquote>
<p>For the second mutate: As you can see in the code below, there is a line break (<code>\n</code>) between every English name and every scientific name in <code>species</code>. We will use that to parse out the scientific name:</p>
<pre class="r"><code>hamilton_cbc %&gt;% 
  filter(row_number() == 1) %&gt;% 
  pull(species)</code></pre>
<pre><code>## [1] &quot;Snow Goose\n[Chen caerulescens]&quot;</code></pre>
<p>Here are the two <code>mutate</code>s together:</p>
<pre class="r"><code># Putting it together: Mutating the two variables
hamilton_cbc &lt;- hamilton_cbc %&gt;%
  mutate(species_latin = str_extract(species, &quot;(?&lt;=\\[).+?(?=\\])&quot;),
         species = word(species, start = 1, sep = fixed(&#39;\n[&#39;)))</code></pre>
<p>Now we will look at the <code>count_year</code> variable. Let’s get a sense of what the variable looks like, using the White-Breasted Nuthatch count in 2016:</p>
<pre class="r"><code>hamilton_cbc %&gt;% 
  filter(row_number() == 15133) %&gt;% 
  pull(count_year)</code></pre>
<pre><code>## [1] &quot;2016 [117]\nCount Date: 12/26/2016\n# Participants: 1\n# Species Reported: 97\nTotal Hrs.: 216.65&quot;</code></pre>
<p>The <code>count_year</code> variable is actually several variables in one:</p>
<ul>
<li>calendar year</li>
<li>[CBC count number]</li>
<li>calendar count date</li>
<li>number of participants</li>
<li>number of species reported</li>
<li>total hours spent that year on the count</li>
</ul>
<p>This is all metadata and we can take it out of this dataset and put it in our <code>overall_meta_data</code> file. The only variable we will keep in the <code>hamilton_cbc</code> dataset is the calendar year, so that we can plot by year and so we can join to the metadata later if we want.</p>
<p>To join the <code>count_participant_meta_data</code> to the <code>overall_meta_data</code>, first we will parse the different variables out:</p>
<pre class="r"><code>count_participant_meta_data &lt;- hamilton_cbc %&gt;%
  distinct(participant_info = count_year) %&gt;%
  mutate(year = word(participant_info)) %&gt;%
  mutate(number_of_participants = str_extract(
    participant_info, &quot;(?&lt;=Participants:\\s).+?(?=\\s#)&quot;)) %&gt;%  # Gets everything between &quot;Participants: &quot; and &quot; #&quot;
  mutate(species_reported = str_extract(
    participant_info, &quot;(?&lt;=Reported:\\s).+?(?=\\nTotal)&quot;)) %&gt;%  # Gets everything between &quot;Reported: &quot; and &quot;Total&quot;
  mutate(total_hours = str_extract(
    participant_info, &quot;(?&lt;=Hrs\\.:\\s).*$&quot;))  # Gets everything after &quot;Hrs.: &quot;
# This regex is different because it goes until the end of the string:
# https://forum.sublimetext.com/t/regex-match-everything-after-this-word/20764

count_participant_meta_data %&gt;%
  head(n = 3) %&gt;%
  kable() %&gt;%
  kable_styling(full_width = FALSE, position = &quot;left&quot;)</code></pre>
<table class="table" style="width: auto !important; ">
<thead>
<tr>
<th style="text-align:left;">
participant_info
</th>
<th style="text-align:left;">
year
</th>
<th style="text-align:left;">
number_of_participants
</th>
<th style="text-align:left;">
species_reported
</th>
<th style="text-align:left;">
total_hours
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1921 [22] Count Date: 12/23/1921 # Participants: # Species Reported: Total Hrs.: 8.00
</td>
<td style="text-align:left;">
1921
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
8.00
</td>
</tr>
<tr>
<td style="text-align:left;">
1922 [23] Count Date: 12/26/1922 # Participants: # Species Reported: Total Hrs.:
</td>
<td style="text-align:left;">
1922
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
1924 [25] Count Date: 12/27/1924 # Participants: # Species Reported: Total Hrs.:
</td>
<td style="text-align:left;">
1924
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
</tbody>
</table>
<p>Since <code>number_of_participants</code> and <code>species_reported</code> ended up having lots of missing data, I decided not to include them in the <code>overall_meta_data</code> dataset.</p>
<pre class="r"><code>count_participant_meta_data &lt;- count_participant_meta_data %&gt;%
  select(year, total_hours)

overall_meta_data &lt;- count_participant_meta_data %&gt;% 
  mutate(year = as.integer(year),
         total_hours = as.double(total_hours)) %&gt;%
  full_join(overall_meta_data, by = &quot;year&quot;)</code></pre>
<p>So, how’s our <code>overall_meta_data</code> looking?</p>
<pre class="r"><code>overall_meta_data %&gt;%
  tail() %&gt;% # Because the first few years contain a lot of NAs
  glimpse()</code></pre>
<pre><code>## Observations: 6
## Variables: 12
## $ year        &lt;dbl&gt; 2012, 2013, 2014, 2015, 2016, 2017
## $ total_hours &lt;dbl&gt; 194.55, 182.20, 179.25, 221.00, 216.65, 198.75
## $ date        &lt;date&gt; 2012-12-26, 2013-12-26, 2014-12-26, 2015-12-26, 2...
## $ count_year  &lt;chr&gt; &quot;113&quot;, &quot;114&quot;, &quot;115&quot;, &quot;116&quot;, &quot;117&quot;, &quot;118&quot;
## $ low_temp    &lt;chr&gt; &quot;-2.0&quot;, &quot;-4.0&quot;, &quot;0.6&quot;, &quot;-2.0&quot;, &quot;-2.0&quot;, &quot;-18.0&quot;
## $ high_temp   &lt;chr&gt; &quot;-2.0&quot;, &quot;-1.0&quot;, &quot;8.3&quot;, &quot;5.0&quot;, &quot;11.0&quot;, &quot;-13.0&quot;
## $ am_cloud    &lt;chr&gt; &quot;Cloudy&quot;, &quot;Cloudy&quot;, &quot;Cloudy&quot;, &quot;Partly Cloudy&quot;, &quot;Cl...
## $ pm_clouds   &lt;chr&gt; &quot;Cloudy&quot;, &quot;Cloudy&quot;, &quot;Cloudy&quot;, &quot;Partly Cloudy&quot;, &quot;Cl...
## $ am_rain     &lt;chr&gt; &quot;None&quot;, NA, &quot;None&quot;, &quot;None&quot;, &quot;Light&quot;, &quot;None&quot;
## $ pm_rain     &lt;chr&gt; &quot;None&quot;, NA, &quot;None&quot;, &quot;Light&quot;, &quot;Heavy\nLight&quot;, &quot;None&quot;
## $ am_snow     &lt;chr&gt; &quot;Light&quot;, &quot;Light&quot;, &quot;None&quot;, &quot;None&quot;, &quot;None&quot;, &quot;None&quot;
## $ pm_snow     &lt;chr&gt; &quot;Light&quot;, &quot;None&quot;, &quot;None&quot;, &quot;None&quot;, &quot;None&quot;, &quot;None&quot;</code></pre>
<p>And where are we at with the <code>hamilton_cbc</code> dataset?</p>
<pre class="r"><code>hamilton_cbc %&gt;%
  tail() %&gt;% # Because the first few years contain a lot of NAs
  glimpse()</code></pre>
<pre><code>## Observations: 6
## Variables: 6
## $ species               &lt;chr&gt; &quot;House Sparrow&quot;, &quot;House Sparrow&quot;, &quot;House...
## $ count_year            &lt;chr&gt; &quot;2012 [113]\nCount Date: 12/26/2012\n# P...
## $ how_many_cw           &lt;chr&gt; &quot;1473&quot;, &quot;1802&quot;, &quot;1318&quot;, &quot;2326&quot;, &quot;2565&quot;, ...
## $ number_by_party_hours &lt;chr&gt; &quot;7.5713&quot;, &quot;9.8902&quot;, &quot;7.3529&quot;, &quot;10.5249&quot;,...
## $ flags                 &lt;chr&gt; NA, NA, NA, NA, NA, NA
## $ species_latin         &lt;chr&gt; &quot;Passer domesticus&quot;, &quot;Passer domesticus&quot;...</code></pre>
<p>Let’s clean up the variables a bit more:</p>
<pre class="r"><code>hamilton_cbc &lt;- hamilton_cbc %&gt;%
  rename(participant_info = count_year,
         how_many_counted = how_many_cw) %&gt;%
  mutate(year = as.integer(word(participant_info)),  # We will keep year and total_hours
         total_hours = as.double(
           str_extract(
             participant_info, &quot;(?&lt;=Hrs\\.:\\s).*$&quot;)))</code></pre>
<p>We almost have a clean dataset! :soon: :sparkles::sparkles::sparkles: :tada:</p>
<p>I am going to remove the <code>flags</code> variable. I am also going to remove <code>number_by_party_hours</code> and derive it myself instead.</p>
<pre class="r"><code>hamilton_cbc &lt;- hamilton_cbc %&gt;%
  select(year, species, species_latin, how_many_counted, total_hours)</code></pre>
<p>It turns out that <code>how_many_counted</code> also has a <code>cw</code> value, which means the bird was not seen on count day itself, but was seen on a day close to the count. I am going to set these bird counts to be <code>NA</code>, as they don’t have a specified value.</p>
<pre class="r"><code>hamilton_cbc &lt;- hamilton_cbc %&gt;%
  mutate(how_many_counted = ifelse(how_many_counted == &quot;cw&quot;, NA, how_many_counted),
         how_many_counted = as.integer(how_many_counted))</code></pre>
<p>In the <code>species</code> variable, there are some rows that are identified only to the genus level (and not to the species level). I will exclude these records, as I believe <a href="https://ebird.org/home">eBird</a> excludes them too.</p>
<pre class="r"><code>hamilton_cbc %&gt;%
filter(str_detect(species, &quot;sp\\.&quot;)) %&gt;%
distinct(species)</code></pre>
<pre><code>## # A tibble: 25 x 1
##    species        
##    &lt;chr&gt;          
##  1 scoter sp.     
##  2 duck sp.       
##  3 loon sp.       
##  4 Accipiter sp.  
##  5 hawk sp.       
##  6 eagle sp.      
##  7 jaeger sp.     
##  8 gull sp.       
##  9 screech-owl sp.
## 10 owl sp.        
## # ... with 15 more rows</code></pre>
<pre class="r"><code>hamilton_cbc &lt;- hamilton_cbc %&gt;%
  filter(!(str_detect(species, &quot;sp\\.&quot;)))</code></pre>
<p>Two final mutates:</p>
<ul>
<li>Using <code>tidyr</code>’s <a href="https://rdrr.io/cran/tidyr/man/replace_na.html"><code>replace_na</code></a> function, let’s make all of the <code>NA</code>s equal to 0 for <code>how_many_counted</code>. That means we are assuming that all birds in the area were successfully counted on count day.</li>
<li>Let’s also calculate the number of birds counted (within each species) divided by the total number of count hours that happened that year.</li>
</ul>
<pre class="r"><code>hamilton_cbc &lt;- hamilton_cbc %&gt;%
  mutate(how_many_counted = replace_na(how_many_counted, 0),
         how_many_counted_by_hour = as.double(how_many_counted) / total_hours)</code></pre>
<p>And that’s it! :smile: :tada: We have cleaned the dataset and are ready to do some visualizing :eyes: in Part 2!</p>
</div>
<div id="final-dataset" class="section level1">
<h1>Final dataset</h1>
<p>Here is a glimpse of our final dataset:</p>
<pre class="r"><code>hamilton_cbc %&gt;%
  tail() %&gt;%
  kable() %&gt;%
  kable_styling(full_width = FALSE, position = &quot;left&quot;)</code></pre>
<table class="table" style="width: auto !important; ">
<thead>
<tr>
<th style="text-align:right;">
year
</th>
<th style="text-align:left;">
species
</th>
<th style="text-align:left;">
species_latin
</th>
<th style="text-align:right;">
how_many_counted
</th>
<th style="text-align:right;">
total_hours
</th>
<th style="text-align:right;">
how_many_counted_by_hour
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
2012
</td>
<td style="text-align:left;">
House Sparrow
</td>
<td style="text-align:left;">
Passer domesticus
</td>
<td style="text-align:right;">
1473
</td>
<td style="text-align:right;">
194.55
</td>
<td style="text-align:right;">
7.571318
</td>
</tr>
<tr>
<td style="text-align:right;">
2013
</td>
<td style="text-align:left;">
House Sparrow
</td>
<td style="text-align:left;">
Passer domesticus
</td>
<td style="text-align:right;">
1802
</td>
<td style="text-align:right;">
182.20
</td>
<td style="text-align:right;">
9.890230
</td>
</tr>
<tr>
<td style="text-align:right;">
2014
</td>
<td style="text-align:left;">
House Sparrow
</td>
<td style="text-align:left;">
Passer domesticus
</td>
<td style="text-align:right;">
1318
</td>
<td style="text-align:right;">
179.25
</td>
<td style="text-align:right;">
7.352859
</td>
</tr>
<tr>
<td style="text-align:right;">
2015
</td>
<td style="text-align:left;">
House Sparrow
</td>
<td style="text-align:left;">
Passer domesticus
</td>
<td style="text-align:right;">
2326
</td>
<td style="text-align:right;">
221.00
</td>
<td style="text-align:right;">
10.524887
</td>
</tr>
<tr>
<td style="text-align:right;">
2016
</td>
<td style="text-align:left;">
House Sparrow
</td>
<td style="text-align:left;">
Passer domesticus
</td>
<td style="text-align:right;">
2565
</td>
<td style="text-align:right;">
216.65
</td>
<td style="text-align:right;">
11.839372
</td>
</tr>
<tr>
<td style="text-align:right;">
2017
</td>
<td style="text-align:left;">
House Sparrow
</td>
<td style="text-align:left;">
Passer domesticus
</td>
<td style="text-align:right;">
2731
</td>
<td style="text-align:right;">
198.75
</td>
<td style="text-align:right;">
13.740880
</td>
</tr>
</tbody>
</table>
<p>And thank you to the CBC! The CBC Data was provided by <a href="www.christmasbirdcount.org">National Audubon Society</a> and through the generous efforts of <a href="www.bsc-eoc.org">Bird Studies Canada</a> and countless volunteers across the western hemisphere.</p>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p><a href="https://news.nationalgeographic.com/news/2014/12/141227-christmas-bird-count-anniversary-audubon-animals-science/" class="uri">https://news.nationalgeographic.com/news/2014/12/141227-christmas-bird-count-anniversary-audubon-animals-science/</a><a href="#fnref1">↩</a></p></li>
</ol>
</div>
